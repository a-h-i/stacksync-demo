# nsjail_cloudrun.cfg â€” works on Cloud Run (no SYS_ADMIN, no mounts, no namespaces)
mode: ONCE
time_limit: 10        # give imports time
max_cpus: 1

# IMPORTANT: disable all namespace cloning
clone_newuser: false
clone_newuts: false
clone_newpid: false
clone_newipc: false
clone_newns: false
clone_newnet: false
clone_newcgroup: false

mount { src: "/" dst: "/" is_bind: true rw: false }
mount { dst: "/tmp" fstype: "tmpfs" rw: true options: "size=134217728" }
mount { dst: "/dev" fstype: "tmpfs" rw: true }
mount { src: "/dev/null"    dst: "/dev/null"    is_bind: true rw: false }
mount { src: "/dev/urandom" dst: "/dev/urandom" is_bind: true rw: false }
mount { src: "/dev/zero"    dst: "/dev/zero"    is_bind: true rw: false }

# Resource limits (MiB)
rlimit_as: 512        # numpy/pandas imports need >256 on slim images
rlimit_fsize: 1
rlimit_nofile: 256

# Clean env + perf-friendly flags
keep_env: false
envar: "PYTHONUNBUFFERED=1"
envar: "PYTHONDONTWRITEBYTECODE=1"
envar: "HOME=/tmp"
envar: "OPENBLAS_NUM_THREADS=1"
envar: "NUMEXPR_MAX_THREADS=1"
envar: "OMP_NUM_THREADS=1"
